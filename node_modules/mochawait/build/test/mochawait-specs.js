/* global describe:true, before:true, beforeEach:true, afterEach:true, it:true, after:true */
require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Promise = require('babel-runtime/core-js/promise')['default'];

require('../index');

require('should');

var _mocha = require('mocha');

function sleep(ms) {
  var start, p;
  return _regeneratorRuntime.async(function sleep$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        start = Date.now();
        p = new _Promise(function (resolve) {
          setTimeout(function () {
            var end = Date.now();
            if (end - start < ms) {
              setTimeout(function () {
                resolve();
              }, end - start);
            } else {
              resolve();
            }
          }, ms);
        });
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(p);

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function slowDouble(x) {
  return _regeneratorRuntime.async(function slowDouble$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(sleep(10));

      case 2:
        return context$1$0.abrupt('return', x * 2);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function slowConcat(str, extra) {
  return _regeneratorRuntime.async(function slowConcat$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(sleep(20));

      case 2:
        return context$1$0.abrupt('return', str + extra);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

describe('mochawait tests', function () {
  var myInt = 2,
      myStr = '',
      testsRun = 0;

  before(function callee$1$0() {
    var start;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          this.should.be.instanceOf(_mocha.Context);
          this.should.have.a.property('timeout');
          start = Date.now();

          myStr.should.equal('');
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(slowConcat(myStr, 'foo'));

        case 6:
          myStr = context$2$0.sent;

          (Date.now() - start).should.be.above(19);

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  beforeEach(function callee$1$0() {
    var start;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          this.should.be.instanceOf(_mocha.Context);
          this.should.have.a.property('timeout');
          start = Date.now();
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(slowDouble(myInt));

        case 5:
          myInt = context$2$0.sent;

          (Date.now() - start).should.be.above(9);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  after(function callee$1$0() {
    var start;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          this.should.be.instanceOf(_mocha.Context);
          this.should.have.a.property('timeout');
          start = Date.now();
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(slowDouble(myInt));

        case 5:
          myInt = context$2$0.sent;

          (Date.now() - start).should.be.above(9);
          myInt.should.equal(32);

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  afterEach(function callee$1$0() {
    var start, i;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          this.should.be.instanceOf(_mocha.Context);
          this.should.have.a.property('timeout');
          start = Date.now();
          i = 0;

        case 4:
          if (!(i < 5)) {
            context$2$0.next = 10;
            break;
          }

          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(sleep(10));

        case 7:
          i++;
          context$2$0.next = 4;
          break;

        case 10:
          if (testsRun === 1) {
            myStr.should.equal('foobar');
          } else {
            myStr.should.equal('foobarbaz');
          }
          (Date.now() - start).should.be.above(49);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should work like mocha', function callee$1$0() {
    var start, then;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          this.should.be.instanceOf(_mocha.Context);
          this.should.have.a.property('timeout');
          myStr.should.equal('foo');
          myInt.should.equal(4);
          start = Date.now();
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(slowDouble(myInt));

        case 7:
          myInt = context$2$0.sent;
          then = Date.now();

          (then - start).should.be.above(9);
          context$2$0.next = 12;
          return _regeneratorRuntime.awrap(slowConcat(myStr, 'bar'));

        case 12:
          myStr = context$2$0.sent;

          (Date.now() - start).should.be.above(19);
          testsRun++;

        case 15:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should work like mocha some more', function callee$1$0() {
    var start;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          this.should.be.instanceOf(_mocha.Context);
          this.should.have.a.property('timeout');
          myStr.should.equal('foobar');
          myInt.should.equal(16);
          start = Date.now();
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(slowConcat(myStr, 'baz'));

        case 7:
          myStr = context$2$0.sent;

          (Date.now() - start).should.be.above(19);
          testsRun++;

        case 10:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvbW9jaGF3YWl0LXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztRQUdPLFVBQVU7O1FBQ1YsUUFBUTs7cUJBQ08sT0FBTzs7QUFFN0IsU0FBZSxLQUFLLENBQUUsRUFBRTtNQUNsQixLQUFLLEVBQ0wsQ0FBQzs7OztBQURELGFBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFO0FBQ2xCLFNBQUMsR0FBRyxhQUFZLFVBQUMsT0FBTyxFQUFLO0FBQy9CLG9CQUFVLENBQUMsWUFBWTtBQUNyQixnQkFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ3JCLGdCQUFJLEFBQUMsR0FBRyxHQUFHLEtBQUssR0FBSSxFQUFFLEVBQUU7QUFDdEIsd0JBQVUsQ0FBQyxZQUFZO0FBQ3JCLHVCQUFPLEVBQUUsQ0FBQztlQUNYLEVBQUUsR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDO2FBQ2pCLE1BQU07QUFDTCxxQkFBTyxFQUFFLENBQUM7YUFDWDtXQUNGLEVBQUUsRUFBRSxDQUFDLENBQUM7U0FDUixDQUFDOzt5Q0FDSSxDQUFDOzs7Ozs7O0NBQ1I7O0FBRUQsU0FBZSxVQUFVLENBQUUsQ0FBQzs7Ozs7eUNBQ3BCLEtBQUssQ0FBQyxFQUFFLENBQUM7Ozs0Q0FDUixDQUFDLEdBQUcsQ0FBQzs7Ozs7OztDQUNiOztBQUVELFNBQWUsVUFBVSxDQUFFLEdBQUcsRUFBRSxLQUFLOzs7Ozt5Q0FDN0IsS0FBSyxDQUFDLEVBQUUsQ0FBQzs7OzRDQUNSLEdBQUcsR0FBRyxLQUFLOzs7Ozs7O0NBQ25COztBQUVELFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxZQUFZO0FBQ3RDLE1BQUksS0FBSyxHQUFHLENBQUM7TUFDVCxLQUFLLEdBQUcsRUFBRTtNQUNWLFFBQVEsR0FBRyxDQUFDLENBQUM7O0FBRWpCLFFBQU0sQ0FBQztRQUdELEtBQUs7Ozs7QUFGVCxjQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLFFBbkNy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RUFBRSxLQUFLLENBQUM7OztBQUF0QyxlQUFLOztBQUNMLFdBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUssQ0FBQSxDQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3pDLGtCQUFRLEVBQUUsQ0FBQzs7Ozs7OztHQUNaLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L21vY2hhd2FpdC1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBkZXNjcmliZTp0cnVlLCBiZWZvcmU6dHJ1ZSwgYmVmb3JlRWFjaDp0cnVlLCBhZnRlckVhY2g6dHJ1ZSwgaXQ6dHJ1ZSwgYWZ0ZXI6dHJ1ZSAqL1xuLy8gdHJhbnNwaWxlOm1vY2hhXG5cbmltcG9ydCAnLi4vaW5kZXgnO1xuaW1wb3J0ICdzaG91bGQnO1xuaW1wb3J0IHtDb250ZXh0fSBmcm9tICdtb2NoYSc7XG5cbmFzeW5jIGZ1bmN0aW9uIHNsZWVwIChtcykge1xuICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICB2YXIgcCA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgZW5kID0gRGF0ZS5ub3coKTtcbiAgICAgIGlmICgoZW5kIC0gc3RhcnQpIDwgbXMpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9LCBlbmQgLSBzdGFydCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9XG4gICAgfSwgbXMpO1xuICB9KTtcbiAgYXdhaXQgcDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2xvd0RvdWJsZSAoeCkge1xuICBhd2FpdCBzbGVlcCgxMCk7XG4gIHJldHVybiB4ICogMjtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2xvd0NvbmNhdCAoc3RyLCBleHRyYSkge1xuICBhd2FpdCBzbGVlcCgyMCk7XG4gIHJldHVybiBzdHIgKyBleHRyYTtcbn1cblxuZGVzY3JpYmUoJ21vY2hhd2FpdCB0ZXN0cycsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IG15SW50ID0gMlxuICAgICwgbXlTdHIgPSAnJ1xuICAgICwgdGVzdHNSdW4gPSAwO1xuXG4gIGJlZm9yZShhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zaG91bGQuYmUuaW5zdGFuY2VPZihDb250ZXh0KTtcbiAgICB0aGlzLnNob3VsZC5oYXZlLmEucHJvcGVydHkoJ3RpbWVvdXQnKTtcbiAgICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIG15U3RyLnNob3VsZC5lcXVhbCgnJyk7XG4gICAgbXlTdHIgPSBhd2FpdCBzbG93Q29uY2F0KG15U3RyLCAnZm9vJyk7XG4gICAgKERhdGUubm93KCkgLSBzdGFydCkuc2hvdWxkLmJlLmFib3ZlKDE5KTtcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zaG91bGQuYmUuaW5zdGFuY2VPZihDb250ZXh0KTtcbiAgICB0aGlzLnNob3VsZC5oYXZlLmEucHJvcGVydHkoJ3RpbWVvdXQnKTtcbiAgICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIG15SW50ID0gYXdhaXQgc2xvd0RvdWJsZShteUludCk7XG4gICAgKERhdGUubm93KCkgLSBzdGFydCkuc2hvdWxkLmJlLmFib3ZlKDkpO1xuICB9KTtcblxuICBhZnRlcihhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zaG91bGQuYmUuaW5zdGFuY2VPZihDb250ZXh0KTtcbiAgICB0aGlzLnNob3VsZC5oYXZlLmEucHJvcGVydHkoJ3RpbWVvdXQnKTtcbiAgICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIG15SW50ID0gYXdhaXQgc2xvd0RvdWJsZShteUludCk7XG4gICAgKERhdGUubm93KCkgLSBzdGFydCkuc2hvdWxkLmJlLmFib3ZlKDkpO1xuICAgIG15SW50LnNob3VsZC5lcXVhbCgzMik7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zaG91bGQuYmUuaW5zdGFuY2VPZihDb250ZXh0KTtcbiAgICB0aGlzLnNob3VsZC5oYXZlLmEucHJvcGVydHkoJ3RpbWVvdXQnKTtcbiAgICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICBhd2FpdCBzbGVlcCgxMCk7XG4gICAgfVxuICAgIGlmICh0ZXN0c1J1biA9PT0gMSkge1xuICAgICAgbXlTdHIuc2hvdWxkLmVxdWFsKCdmb29iYXInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbXlTdHIuc2hvdWxkLmVxdWFsKCdmb29iYXJiYXonKTtcbiAgICB9XG4gICAgKERhdGUubm93KCkgLSBzdGFydCkuc2hvdWxkLmJlLmFib3ZlKDQ5KTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB3b3JrIGxpa2UgbW9jaGEnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zaG91bGQuYmUuaW5zdGFuY2VPZihDb250ZXh0KTtcbiAgICB0aGlzLnNob3VsZC5oYXZlLmEucHJvcGVydHkoJ3RpbWVvdXQnKTtcbiAgICBteVN0ci5zaG91bGQuZXF1YWwoJ2ZvbycpO1xuICAgIG15SW50LnNob3VsZC5lcXVhbCg0KTtcbiAgICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIG15SW50ID0gYXdhaXQgc2xvd0RvdWJsZShteUludCk7XG4gICAgbGV0IHRoZW4gPSBEYXRlLm5vdygpO1xuICAgICh0aGVuIC0gc3RhcnQpLnNob3VsZC5iZS5hYm92ZSg5KTtcbiAgICBteVN0ciA9IGF3YWl0IHNsb3dDb25jYXQobXlTdHIsICdiYXInKTtcbiAgICAoRGF0ZS5ub3coKSAtIHN0YXJ0KS5zaG91bGQuYmUuYWJvdmUoMTkpO1xuICAgIHRlc3RzUnVuKys7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgd29yayBsaWtlIG1vY2hhIHNvbWUgbW9yZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNob3VsZC5iZS5pbnN0YW5jZU9mKENvbnRleHQpO1xuICAgIHRoaXMuc2hvdWxkLmhhdmUuYS5wcm9wZXJ0eSgndGltZW91dCcpO1xuICAgIG15U3RyLnNob3VsZC5lcXVhbCgnZm9vYmFyJyk7XG4gICAgbXlJbnQuc2hvdWxkLmVxdWFsKDE2KTtcbiAgICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIG15U3RyID0gYXdhaXQgc2xvd0NvbmNhdChteVN0ciwgJ2JheicpO1xuICAgIChEYXRlLm5vdygpIC0gc3RhcnQpLnNob3VsZC5iZS5hYm92ZSgxOSk7XG4gICAgdGVzdHNSdW4rKztcbiAgfSk7XG59KTtcbiJdfQ==